import{o as E,r as u,h as o,j as e,D as j,E as I}from"./index-Cwsbtslf.js";import"./dayjs.min-Cg-n98_e.js";import{c as g,a as p,e as T,F,b as v,C as m,f as z,g as M}from"./CustomCFormInput-R6ZhCQt0.js";import{C as O,a as L}from"./CustomCFormFileInput-Qmg440vX.js";import{e as b}from"./isSymbol-C4hJnqVa.js";import{C as S,a as D}from"./CCardBody-Bc4MtlRY.js";import{b as U,a as R}from"./CContainer-Y1mteLO7.js";import{C as d,a as t}from"./CRow-YNLixlNm.js";import{a as n}from"./CFormInput--xOEIcm_.js";import{e as V,f as P,g as y,h as Y,i as N}from"./DefaultLayout-D3YC1NaJ.js";import"./index.esm-BC4b9ao9.js";import"./cil-user-Ddrdy7PS.js";const Z=()=>{const w=g().shape({oldPassword:p().required("Old password is required"),password:p().required("Password is required").min(8,"Password must be at least 8 characters").test("isStrong","Password is not secure.",r=>{if(!r)return!1;const l=/[A-Z]/.test(r),a=/[a-z]/.test(r),h=/[0-9]/.test(r),x=/[!@#$%^&*(),.?":{}|<>]/.test(r);return l&&a&&h&&x}),confirmPassword:p().required("Confirm password is required").oneOf([T("password"),null],"Passwords must match")});u.useEffect(()=>((async()=>{var l;await o.getUserByMe(),(l=o.userDetailByMe)!=null&&l.mustChangePassword&&j.error("You must change your password because it is expired.")})(),()=>o.clearUserDetail()),[]);const c=async(r,{setSubmitting:l,setFieldValue:a})=>{const h={oldPassword:b(r.oldPassword),password:b(r.password)};try{await o.updatePasswordUser(h),j.success("Password updated successfully.")}catch{j.error("Failed to update password."),a("oldPassword",""),a("password",""),a("confirmPassword","")}finally{l(!1)}};return e.jsx(F,{initialValues:{oldPassword:"",password:"",confirmPassword:""},validationSchema:w,onSubmit:c,children:({isSubmitting:r})=>e.jsx(v,{children:e.jsx(S,{className:"mb-4 mt-4",children:e.jsx(D,{children:e.jsxs(U,{children:[e.jsxs(d,{children:[e.jsxs(t,{md:12,children:[e.jsx(n,{htmlFor:"email",className:"mt-3",children:"Old Password"}),e.jsx(m,{name:"oldPassword",type:"password",label:"Old Password",placeholder:"Enter your old password"})]}),e.jsxs(t,{md:12,children:[e.jsx(n,{htmlFor:"email",className:"mt-3",children:"New Password"}),e.jsx(m,{name:"password",type:"password",label:"New Password",placeholder:"Enter your new password"})]}),e.jsxs(t,{md:12,children:[e.jsx(n,{htmlFor:"email",className:"mt-3",children:"Confirm Password"}),e.jsx(m,{name:"confirmPassword",type:"password",label:"Confirm Password",placeholder:"Confirm your new password"})]})]}),e.jsx(d,{className:"mt-3",children:e.jsx(t,{children:e.jsx(R,{type:"submit",color:"primary",disabled:r,variant:"outline",children:"Change Password"})})})]})})})})})},G=E(Z),H=()=>{const w=g().shape({fullName:p().required("Fullname is required").max(100),email:p().email("Email is invalid").required("Email is required"),avatar:M().nullable(!0).test("fileSize","Size limit 5MB",s=>s?s.size<=5242880:!0).test("fileFormat","The type is not allow",s=>s?["image/jpg","image/jpeg","image/png"].includes(s.type):!0),isRealEmail:z(),contactEmail:p().when("isRealEmail",{is:!1,then:s=>s.email("Email is invalid").required("Contact email is required"),otherwise:s=>s.notRequired()})}),[c,r]=u.useState("detail");let{userCode:l}=I();u.useEffect(()=>((async()=>{l&&await o.getUserByUserCode(l)})(),()=>o.clearUserDetail()),[l]);let a=l?o.userDetail:o.userDetailByMe;const h=!l,[x,q]=u.useState(!1),[$,k]=u.useState({userName:a?a.userName:"",fullName:"",email:"",avatar:null,isRealEmail:!0,contactEmail:""});u.useEffect(()=>{a&&k({userName:a.userName,fullName:a.fullName,email:a.email,avatar:null,isRealEmail:a.isRealEmail,contactEmail:a.contactEmail})},[a]);const B=s=>{s("avatar",null),a.avatarUrl=null,q(!0)},A=async(s,{setSubmitting:f,setFieldValue:C})=>{try{const i=new FormData;i.append("fullName",s.fullName),i.append("email",s.email),i.append("id",a.id),s.avatar&&i.append("avatar",s.avatar),i.append("isDeletedAvatar",x),(!s.isRealEmail||!a.isRealEmail)&&(i.append("isRealEmail",s.isRealEmail),i.append("contactEmail",s.contactEmail)),await o.updateUser(i)}catch{}finally{f(!1)}};return e.jsxs(V,{variant:"tabs",role:"tablist",children:[e.jsx(P,{children:e.jsx(y,{active:c==="detail",onClick:()=>r("detail"),role:"button",children:"User Detail"})}),h&&e.jsx(P,{children:e.jsx(y,{active:c==="password",onClick:()=>r("password"),role:"button",children:"Change Password"})}),e.jsxs(Y,{children:[e.jsx(N,{visible:c==="detail",children:e.jsx(d,{children:e.jsx(t,{xs:12,children:a&&e.jsx(F,{initialValues:$,enableReinitialize:!0,validationSchema:w,onSubmit:A,children:({isSubmitting:s,setFieldValue:f,values:C})=>e.jsx(v,{children:e.jsx(S,{className:"mb-4 mt-4",children:e.jsx(D,{children:e.jsx(U,{children:e.jsxs(d,{children:[e.jsx(t,{md:3,children:e.jsx(O,{name:"avatar",label:"Upload Avatar",accept:"image/*",initialImageUrl:a==null?void 0:a.avatarUrl,onDelete:B})}),e.jsxs(t,{md:9,children:[e.jsxs(d,{children:[e.jsxs(t,{md:6,children:[e.jsx(n,{htmlFor:"userName",children:"Username"}),e.jsx(m,{name:"userName",type:"text",className:"mb-4",disabled:!0})]}),e.jsxs(t,{md:6,children:[e.jsx(n,{htmlFor:"fullName",children:"Fullname"}),e.jsx(m,{name:"fullName",type:"text",className:"mb-4"})]}),e.jsxs(t,{md:6,children:[e.jsx(n,{htmlFor:"email",children:"Email"}),e.jsx(m,{name:"email",type:"text",className:"mb-4"})]}),e.jsx(t,{md:6,children:!C.isRealEmail&&e.jsxs(e.Fragment,{children:[e.jsx(n,{htmlFor:"contactEmail",children:"Contact Email"}),e.jsx(m,{name:"contactEmail",type:"text",className:"mb-4"})]})}),e.jsxs(t,{md:6,children:[e.jsx(n,{htmlFor:"email",children:"Real email"}),e.jsx(L,{id:"formSwitchCheckChecked",defaultChecked:!0,name:"isRealEmail"})]})]}),e.jsx(d,{className:"mt-3",children:e.jsx(t,{children:e.jsx(R,{type:"submit",color:"primary",variant:"outline",className:"float-end",disabled:s,children:"Update"})})})]})]})})})})})})})})}),h&&e.jsx(N,{visible:c==="password",children:e.jsx(d,{className:"mt-5",children:e.jsx(t,{xs:12,children:e.jsx(G,{})})})})]})]})},ie=E(H);export{ie as default};
