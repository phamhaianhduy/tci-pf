var v=Object.defineProperty;var B=(r,s,a)=>s in r?v(r,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[s]=a;var i=(r,s,a)=>B(r,typeof s!="symbol"?s+"":s,a);import{z as O,A as K,B as U,o as q,r as o,j as e}from"./index-Cwsbtslf.js";import{d as b}from"./dayjs.min-Cg-n98_e.js";import{c as z,d as w,a as _,F as G,b as J,C as y}from"./CustomCFormInput-R6ZhCQt0.js";import{P as Q}from"./Pagination-ggx9u1sv.js";import{C as T,a as u}from"./CRow-YNLixlNm.js";import{b as W,a as I}from"./CContainer-Y1mteLO7.js";import{C as X,a as Z}from"./CCardBody-Bc4MtlRY.js";import{C as V}from"./CCardHeader-qQtIod6a.js";import{C as A,d as F,c as n,a as ee,b as N,e as D}from"./CTable-BN3hIRiw.js";import"./isSymbol-C4hJnqVa.js";import"./CFormInput--xOEIcm_.js";class te{constructor(){i(this,"logs",[]);i(this,"page",1);i(this,"totalPages",1);i(this,"getLogs",async(s="timestamp",a="desc",m="",j=1,C="",p="",d=10)=>{try{const h=Object.entries({sortColumn:s,sortOrder:a,searchString:m,page:j,fromDate:C,toDate:p,itemPerPage:d}).filter(([x,l])=>l!=null).map(([x,l])=>`${encodeURIComponent(x)}=${encodeURIComponent(l)}`).join("&"),c=await K.get(`/logs/list?${h}`);U(()=>{this.logs=c.data.listLogs,this.currentPage=c.data.currentPage,this.totalPages=c.data.totalPages})}catch(g){console.error("Fetch failed",g)}finally{}});i(this,"setPage",s=>{this.page=s,this.getLogs()});i(this,"clearLogDetail",()=>{this.userDetail=null});O(this)}}const P=new te,se=()=>{const r=z().shape({searchString:_(),fromDate:w().typeError("Invalid date"),toDate:w().typeError("Invalid date")}),[s,a]=o.useState(1),[m,j]=o.useState(""),[C,p]=o.useState(m),[d,g]=o.useState("timestamp"),[h,c]=o.useState("desc"),[x,l]=o.useState(""),[L,Y]=o.useState("");o.useEffect(()=>{P.getLogs(d,h,C,s,x,L)},[d,h,C,s,x,L]);const R=t=>{j(t.target.value.toLowerCase())},S=t=>{t===d?c(h==="asc"?"desc":"asc"):(g(t),c("asc"))},$=t=>{t("fromDate",""),t("toDate",""),t("searchString",""),l(""),Y(""),j(""),p(""),g("timestamp"),c("desc"),a(1)},E=t=>a(t),M=t=>{l(t.fromDate?b(t.fromDate).format("YYYY-MM-DD 00:00:00"):null),Y(t.toDate?b(t.toDate).format("YYYY-MM-DD 23:59:59"):null),p(m),a(1)},H=P.totalPages,f=t=>d!==t?"⇅":h==="asc"?"↑":"↓",k=P.logs;return e.jsxs(T,{children:[e.jsxs(u,{xs:12,children:[e.jsx(G,{initialValues:{searchString:"",fromDate:"",toDate:""},validationSchema:r,onSubmit:M,children:({setFieldValue:t,resetForm:ae})=>e.jsx(J,{style:{display:"flex",gap:"10px"},children:e.jsx(W,{children:e.jsxs(T,{children:[e.jsx(u,{md:4,children:e.jsx(y,{name:"searchString",placeholder:"Input search string",autoComplete:"searchString",type:"text",onChange:R,value:m,className:"mb-4"})}),e.jsx(u,{md:4,children:e.jsx(y,{name:"fromDate",type:"date",className:"mb-4"})}),e.jsx(u,{md:4,children:e.jsx(y,{name:"toDate",type:"date",className:"mb-4"})}),e.jsxs(u,{md:12,children:[e.jsx(I,{type:"submit",onClick:()=>p(m),color:"primary",children:"Search"})," ",e.jsx(I,{type:"button",onClick:()=>$(t),color:"primary",children:"Reset"})]})]})})})}),e.jsxs(X,{className:"mb-4 mt-4",children:[e.jsx(V,{children:e.jsx("strong",{children:"Log List"})}),e.jsx(Z,{children:e.jsx(A,{striped:!0,children:e.jsx(F,{children:e.jsx(n,{colSpan:4,children:e.jsxs(A,{children:[e.jsx(ee,{color:"dark",children:e.jsxs(N,{children:[e.jsxs(n,{scope:"col",onClick:()=>S("fullName"),role:"button",children:["Fullname ",f("fullName")]}),e.jsxs(n,{scope:"col",onClick:()=>S("email"),role:"button",children:["Email ",f("email")]}),e.jsxs(n,{scope:"col",onClick:()=>S("action"),role:"button",children:["Action ",f("action")]}),e.jsx(n,{scope:"col",children:"Description"}),e.jsxs(n,{scope:"col",onClick:()=>S("updatedAt"),role:"button",children:["Timestamp ",f("updatedAt")]}),e.jsx(n,{scope:"col",children:"Action"})]})}),e.jsx(F,{children:k.length>0&&k.map(t=>e.jsx(e.Fragment,{children:e.jsxs(N,{children:[e.jsx(n,{scope:"row",children:t.user.fullName}),e.jsx(D,{children:t.user.email}),e.jsx(D,{children:t.action}),e.jsx(D,{children:t.description}),e.jsx(D,{children:b(t.timestamp).format("YYYY/MM/DD HH:mm:ss")})]})}))})]})})})})})]})]}),e.jsx(Q,{currentPage:s,totalPages:H,maxPagesToShow:5,onPageChange:E})]})},ue=q(se);export{ue as default};
